name: Build Kivy APK

on: [push, workflow_dispatch]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip openjdk-17-jdk git expect
        pip install buildozer
        
    - name: Build APK with auto-confirmation
      run: |
        # Используем expect для автоматического ответа на вопросы
        expect -c "
          set timeout 1200
          spawn buildozer -v android debug
          expect {
            \"Are you sure\" { send \"y\r\"; exp_continue }
            \"continue?\" { send \"y\r\"; exp_continue }
            \"(y/n)\" { send \"y\r\"; exp_continue }
            eof
          }
        "
      
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: app-apk
        path: bin/*.apk
        retention-days: 30